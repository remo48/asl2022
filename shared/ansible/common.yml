---
- hosts: all
  become: yes
  tasks:
    - name: Update and upgrade apt packages
      apt:
        upgrade: "yes"
        update_cache: yes

- hosts: dbservers, webservers, caservers
  become: yes
  tasks:
    - name: Install Python pip
      apt: 
        name: python3-pip 
        update_cache: true 
        state: present 
        force_apt_get: yes

- hosts: dbservers, webservers
  become: yes
  tasks:
    - name: Install Python packages
      pip: 
        name: mysql-connector-python
        
- hosts: webservers, caservers
  become: yes
  tasks:
    - name: Add users
      user:
        name: "{{ username }}"
        password_lock: yes
        shell: "{{ usershell }}"